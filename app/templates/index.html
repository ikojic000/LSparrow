<!doctype html>
<html lang="hr">
  <head>
    <meta charset="UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0" />
    <title>LSparrow - CSV Statistics</title>
    <link rel="preconnect" href="https://fonts.googleapis.com" />
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin />
    <link
      href="https://fonts.googleapis.com/css2?family=Alan+Sans:wght@300..900&family=Comic+Relief:wght@400;700&display=swap"
      rel="stylesheet" />
    <link
      href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/css/bootstrap.min.css"
      rel="stylesheet" />
    <style>
      body {
        font-family: "Alan Sans", sans-serif;
        background-color: #f8f9fa;
        padding-top: 2rem;
      }
      .card {
        box-shadow: 0 0.5rem 1rem rgba(0, 0, 0, 0.15);
        margin-bottom: 1.5rem;
      }
      .table-responsive {
        max-height: 70vh;
        overflow-y: auto;
      }
      .question-col {
        max-width: 400px;
        word-wrap: break-word;
      }
      thead th {
        position: sticky;
        top: 0;
        background-color: #212529;
        z-index: 1;
      }
      .stats-info {
        font-size: 0.85rem;
        color: #6c757d;
      }
      .group-section {
        display: none;
      }
      .group-section.active {
        display: block;
      }
      .group-header {
        background-color: #0d6efd;
        color: white;
        padding: 0.5rem 1rem;
        margin-top: 1rem;
        border-radius: 0.375rem;
      }
      .filter-card {
        background-color: #e9ecef;
        border: none;
      }
      .nav-pills .nav-link.active {
        background-color: #198754;
      }
      .lsparrow-header-logo {
        max-width: 120px;
        height: auto;
        vertical-align: middle;
        margin-right: 0.5rem;
      }
    </style>
  </head>
  <body>
    <div class="container">
      <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
          <h1 class="text-center mb-4">
            <img
              src="{{ url_for('static', filename='images/svg/logo_1.svg') }}"
              alt="LSparrow"
              class="lsparrow-header-logo" />
            LSparrow
          </h1>
          <p class="text-center text-muted">
            Upload a Google Forms CSV file to calculate statistics for 1-5 scale
            questions
          </p>
        </div>
      </div>

      <div class="row justify-content-center mb-4">
        <div class="col-lg-8">
          <div class="card">
            <div class="card-body">
              <form method="POST" enctype="multipart/form-data">
                <div class="mb-3">
                  <label for="csv_file" class="form-label"
                    >Select CSV File</label
                  >
                  <input
                    type="file"
                    class="form-control"
                    id="csv_file"
                    name="csv_file"
                    accept=".csv"
                    required />
                  <div class="form-text">
                    Upload a CSV file exported from Google Forms. Only questions
                    with 1-5 scale answers will be analyzed.
                  </div>
                </div>
                <button type="submit" class="btn btn-primary w-100">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="16"
                    height="16"
                    fill="currentColor"
                    class="bi bi-upload me-2"
                    viewBox="0 0 16 16">
                    <path
                      d="M.5 9.9a.5.5 0 0 1 .5.5v2.5a1 1 0 0 0 1 1h12a1 1 0 0 0 1-1v-2.5a.5.5 0 0 1 1 0v2.5a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2v-2.5a.5.5 0 0 1 .5-.5z" />
                    <path
                      d="M7.646 1.146a.5.5 0 0 1 .708 0l3 3a.5.5 0 0 1-.708.708L8.5 2.707V11.5a.5.5 0 0 1-1 0V2.707L5.354 4.854a.5.5 0 1 1-.708-.708l3-3z" />
                  </svg>
                  Upload and Calculate
                </button>
              </form>
            </div>
          </div>
        </div>
      </div>

      {% if error %}
      <div class="row justify-content-center mb-4">
        <div class="col-lg-10">
          <div class="alert alert-danger" role="alert">
            <strong>Error:</strong> {{ error }}
          </div>
        </div>
      </div>
      {% endif %} {% if results %}
      <!-- Grouping Filter -->
      <div class="row justify-content-center mb-4">
        <div class="col-lg-12">
          <div class="card filter-card">
            <div class="card-body">
              <div class="row align-items-center">
                <div class="col-md-4">
                  <label for="groupingSelect" class="form-label fw-bold mb-0">
                    <svg
                      xmlns="http://www.w3.org/2000/svg"
                      width="16"
                      height="16"
                      fill="currentColor"
                      class="bi bi-filter me-2"
                      viewBox="0 0 16 16">
                      <path
                        d="M6 10.5a.5.5 0 0 1 .5-.5h3a.5.5 0 0 1 0 1h-3a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h7a.5.5 0 0 1 0 1h-7a.5.5 0 0 1-.5-.5zm-2-3a.5.5 0 0 1 .5-.5h11a.5.5 0 0 1 0 1h-11a.5.5 0 0 1-.5-.5z" />
                    </svg>
                    Group Statistics By:
                  </label>
                </div>
                <div class="col-md-8">
                  <select
                    class="form-select"
                    id="groupingSelect"
                    onchange="showGrouping(this.value)">
                    <option value="overall" selected>
                      Overall (All Respondents)
                    </option>
                    {% for key, info in results.groupings.items() %}
                    <option value="{{ key }}">
                      {{ info.label }} ({{ info.column }})
                    </option>
                    {% endfor %}
                  </select>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Overall Results -->
      <div id="section-overall" class="group-section active">
        <div class="row justify-content-center">
          <div class="col-lg-12">
            <div class="card">
              <div class="card-header bg-success text-white">
                <h5 class="mb-0">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    fill="currentColor"
                    class="bi bi-table me-2"
                    viewBox="0 0 16 16">
                    <path
                      d="M0 2a2 2 0 0 1 2-2h12a2 2 0 0 1 2 2v12a2 2 0 0 1-2 2H2a2 2 0 0 1-2-2V2zm15 2h-4v3h4V4zm0 4h-4v3h4V8zm0 4h-4v3h3a1 1 0 0 0 1-1v-2zm-5 3v-3H6v3h4zm-5 0v-3H1v2a1 1 0 0 0 1 1h3zm-4-4h4V8H1v3zm0-4h4V4H1v3zm5-3v3h4V4H6zm4 4H6v3h4V8z" />
                  </svg>
                  Overall Statistics ({{ results.overall|length }} questions
                  analyzed)
                </h5>
              </div>
              <div class="card-body">
                <div class="stats-info mb-3">
                  <strong>Legend:</strong>
                  N = Count | AS = Arithmetic Mean | SD = Standard Deviation |
                  Ske = Skewness | Kur = Kurtosis | Max D = K-S Statistic | K-S
                  p = K-S p-value
                </div>
                <div class="table-responsive">
                  <table class="table table-striped table-hover table-bordered">
                    <thead class="table-dark">
                      <tr>
                        <th>#</th>
                        <th class="question-col">Question</th>
                        <th>N</th>
                        <th>AS</th>
                        <th>SD</th>
                        <th>Median</th>
                        <th>Ske</th>
                        <th>Kur</th>
                        <th>Max D</th>
                        <th>K-S p</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for row in results.overall %}
                      <tr>
                        <td>{{ loop.index }}</td>
                        <td class="question-col">{{ row.question }}</td>
                        <td>{{ row.N }}</td>
                        <td>{{ row.AS }}</td>
                        <td>{{ row.SD }}</td>
                        <td>{{ row.Median }}</td>
                        <td>{{ row.Ske }}</td>
                        <td>{{ row.Kur }}</td>
                        <td>{{ row['Max D'] }}</td>
                        <td>{{ row['K-S p'] }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
          </div>
        </div>
      </div>

      <!-- Grouped Results -->
      {% for group_key, group_info in results.groupings.items() %}
      <div id="section-{{ group_key }}" class="group-section">
        <div class="row justify-content-center">
          <div class="col-lg-12">
            <div class="alert alert-info">
              <strong>Grouped by:</strong> {{ group_info.column }} <br /><small
                >Showing separate statistics for each {{ group_info.label|lower
                }} category</small
              >
            </div>

            {% for group_value, group_stats in
            results.grouped[group_key].items() %}
            <div class="card">
              <div class="card-header bg-primary text-white">
                <h5 class="mb-0">
                  <svg
                    xmlns="http://www.w3.org/2000/svg"
                    width="20"
                    height="20"
                    fill="currentColor"
                    class="bi bi-people-fill me-2"
                    viewBox="0 0 16 16">
                    <path
                      d="M7 14s-1 0-1-1 1-4 5-4 5 3 5 4-1 1-1 1H7Zm4-6a3 3 0 1 0 0-6 3 3 0 0 0 0 6Zm-5.784 6A2.238 2.238 0 0 1 5 13c0-1.355.68-2.75 1.936-3.72A6.325 6.325 0 0 0 5 9c-4 0-5 3-5 4s1 1 1 1h4.216ZM4.5 8a2.5 2.5 0 1 0 0-5 2.5 2.5 0 0 0 0 5Z" />
                  </svg>
                  {{ group_value }}
                  <span class="badge bg-light text-dark ms-2"
                    >{{ group_stats|length }} questions</span
                  >
                </h5>
              </div>
              <div class="card-body">
                <div class="stats-info mb-3">
                  <strong>Legend:</strong>
                  N = Count | AS = Arithmetic Mean | SD = Standard Deviation |
                  Ske = Skewness | Kur = Kurtosis | Max D = K-S Statistic | K-S
                  p = K-S p-value
                </div>
                <div class="table-responsive">
                  <table
                    class="table table-striped table-hover table-bordered table-sm">
                    <thead class="table-dark">
                      <tr>
                        <th>#</th>
                        <th class="question-col">Question</th>
                        <th>N</th>
                        <th>AS</th>
                        <th>SD</th>
                        <th>Median</th>
                        <th>Ske</th>
                        <th>Kur</th>
                        <th>Max D</th>
                        <th>K-S p</th>
                      </tr>
                    </thead>
                    <tbody>
                      {% for row in group_stats %}
                      <tr>
                        <td>{{ loop.index }}</td>
                        <td class="question-col">{{ row.question }}</td>
                        <td>{{ row.N }}</td>
                        <td>{{ row.AS }}</td>
                        <td>{{ row.SD }}</td>
                        <td>{{ row.Median }}</td>
                        <td>{{ row.Ske }}</td>
                        <td>{{ row.Kur }}</td>
                        <td>{{ row['Max D'] }}</td>
                        <td>{{ row['K-S p'] }}</td>
                      </tr>
                      {% endfor %}
                    </tbody>
                  </table>
                </div>
              </div>
            </div>
            {% endfor %}
          </div>
        </div>
      </div>
      {% endfor %} {% endif %}

      <footer class="text-center mt-5 mb-3 text-muted">
        <small>LSparrow - Statistical Analysis for Survey Data</small>
      </footer>
    </div>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.3.2/dist/js/bootstrap.bundle.min.js"></script>
    <script>
      function showGrouping(value) {
        // Hide all sections
        document.querySelectorAll(".group-section").forEach(function (section) {
          section.classList.remove("active");
        });
        // Show selected section
        var selectedSection = document.getElementById("section-" + value);
        if (selectedSection) {
          selectedSection.classList.add("active");
        }
      }
    </script>
  </body>
</html>
